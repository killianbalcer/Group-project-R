#1.1
# Parameters
S0 <- 150          # Initial stock price
r <- 0.04          # Risk-free rate (annual)
sigma <- 0.3       # Volatility
T <- 1             # Time to maturity (years)
K <- 150           # Strike price
m <- 12            # Number of fixing dates (monthly)
N <- 10000           # Number of simulations
delta_t <- T / m   # Time interval between fixings

# Monte Carlo Simulation
set.seed(123)      # For reproducibility
payoffs <- numeric(N)

for (i in 1:N) {
  # Simulate m stock prices
  S <- numeric(m)
  S[1] <- S0
  for (j in 2:m) {
    Z <- rnorm(1)  # Generate standard normal random variable
    S[j] <- S[j - 1] * exp((r - 0.5 * sigma^2) * delta_t + sigma * sqrt(delta_t) * Z)
  }
  
  # Geometric average
  A_T <- prod(S)^(1 / m)
  
  # Payoff calculation
  payoff <- max(0, A_T - K)
  payoffs[i] <- payoff
}

# Discounted payoff
average_payoff <- mean(payoffs)
V0 <- exp(-r * T) * average_payoff
# Output the price
cat("Geometric Asian Option Price using Monte Carlo Simulation:", V0, "\n")


# Illustrative Plot for One Path
set.seed(456)  # For reproducibility
daily_obs <- 365         # Number of daily observations
delta_t_daily <- T / daily_obs
S_daily <- numeric(daily_obs)
S_fixing <- numeric(m)
S_daily[1] <- S0

# Simulate daily prices
for (j in 2:daily_obs) {
  Z <- rnorm(1)
  S_daily[j] <- S_daily[j - 1] * exp((r - 0.5 * sigma^2) * delta_t_daily + sigma * sqrt(delta_t_daily) * Z)
}
# Extract monthly fixing prices
fixing_indices <- seq(1, daily_obs, length.out = m)
S_fixing <- S_daily[round(fixing_indices)]
# Geometric average for illustrative path
A_T_illustrative <- prod(S_fixing)^(1 / m)
# Plot
plot(
  1:daily_obs, S_daily, type = "l", col = "blue", lwd = 2,
  xlab = "Time (Days)", ylab = "Stock Price",
  main = "Illustrative Path for Geometric Asian Option"
)
points(fixing_indices, S_fixing, col = "red", pch = 19, cex = 1.5)  # Fixing prices
abline(h = K, col = "grey", lty = 2, lwd = 2)  # Strike price
abline(h = A_T_illustrative, col = "red", lty = 2, lwd = 2)  # Geometric average

# Add Legend
legend("topleft", legend = c("Daily Stock Price", "Fixing Prices", paste("Geometric Avg :", round(A_T_illustrative, 2)), "Strike Price"),
  col = c("blue", "red", "red", "grey"),
  lty = c(1, NA, 2, 2), 
  pch = c(NA, 19, NA, NA), 
  lwd = c(2, NA, 2, 2)
)
